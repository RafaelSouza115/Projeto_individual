<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="../style/global.css">
    <link rel="stylesheet" href="../style/dash/nav.css">
    <link rel="stylesheet" href="../style/dash/perguntas.css">

    <title>Rebobinando | Quiz</title>
</head>

<body>
    <div class="principal">

        <div id="painelJogo" style="display: block;">
            <h2 id="tituloPergunta"></h2>

            <div id="alternativas"></div>
            <div class="bts">
                <button id="btnVoltar" style="display:none;">Voltar</button>
                <!-- <button id="btnConfirmar" style="display:none;">Confirmar resposta</button> -->
                <button id="btnProxima" style="display:none;">Próxima</button>
            </div>
        </div>

        <div id="painelFinal" style="display: none;">
            <h2>Resultado Final</h2>

            <p>Acertos: <span id="spanCertas"></span></p>
            <p>Erros: <span id="spanErradas"></span></p>
            <p>Pontuação: <span id="spanPontuacaoFinal"></span></p>

            <button id="btnReiniciar">Tentar Novamente</button>
        </div>

    </div>

</body>
<script>
    let questoes = [
    {
        pergunta: "Quando os Tribalistas se reuniram pela primeira vez?",
        alternativas: ["1998", "2002", "2006", "2010"],
        correta: 1
    },
    {
        pergunta: "Qual desses NÃO é integrante dos Tribalistas?",
        alternativas: ["Marisa Monte", "Arnaldo Antunes", "Carlinhos Brown", "Djavan"],
        correta: 3
    },
    {
        pergunta: "Qual é o nome do primeiro álbum dos Tribalistas?",
        alternativas: ["Velha Infância", "Tribalistas", "Mistério da Vida", "Carnavália"],
        correta: 1
    },
    {
        pergunta: "Qual música dos Tribalistas contém o verso 'Meu coração é teu'?",
        alternativas: ["Velha Infância", "Já Sei Namorar", "É Você", "Carnavália"],
        correta: 0
    },
    {
        pergunta: "Em que ano o segundo álbum dos Tribalistas foi lançado?",
        alternativas: ["2017", "2014", "2010", "2019"],
        correta: 0
    },
    {
        pergunta: "Qual desses é um grande sucesso dos Tribalistas?",
        alternativas: ["Velha Infância", "Sua Cara", "Amor I Love You", "Pra Me Refazer"],
        correta: 0
    },
    {
        pergunta: "Como é o nome da música que abre o álbum 'Tribalistas' de 2002?",
        alternativas: ["É Você", "Carnavália", "O Amor é Feio", "Passe Em Casa"],
        correta: 1
    },
    {
        pergunta: "Qual destes gêneros musicais mais influenciam o som dos Tribalistas?",
        alternativas: ["Axé", "MPB", "Sertanejo", "Rock"],
        correta: 1
    },
    {
        pergunta: "Quem é responsável pelos vocais principais em muitas músicas dos Tribalistas?",
        alternativas: ["Arnaldo Antunes", "Marisa Monte", "Carlinhos Brown", "Todos revezam"],
        correta: 3
    },
    {
        pergunta: "Qual música dos Tribalistas foi tema de novela da Globo?",
        alternativas: ["Já Sei Namorar", "Velha Infância", "É Você", "Carnavália"],
        correta: 1
    }
];


    let indice = 0;
    let acertos = 0;
    let erros = 0;

    // Armazena as respostas escolhidas para poder voltar
    let respostasUsuario = {};

    const tituloPergunta = document.getElementById("tituloPergunta");
    const alternativasDiv = document.getElementById("alternativas");
    const btnProxima = document.getElementById("btnProxima");
    const btnVoltar = document.getElementById("btnVoltar");
    // const btnConfirmar = document.getElementById("btnConfirmar");
    const painelJogo = document.getElementById("painelJogo");
    const painelFinal = document.getElementById("painelFinal");

    carregarPergunta();

    function carregarPergunta() {
        let q = questoes[indice];

        tituloPergunta.innerText = q.pergunta;
        alternativasDiv.innerHTML = "";

        // controla se o botão voltar aparece
        btnVoltar.style.display = indice === 0 ? "none" : "block";
        btnProxima.style.display = "none";

        q.alternativas.forEach((texto, i) => {
            let alt = document.createElement("div");
            alt.className = "alternativa";
            alt.innerText = texto;

            alt.onclick = () => escolher(i);

            // se o usuário já tinha respondido, marca visualmente
            if (respostasUsuario[indice] === i) {
                alt.style.backgroundColor = "#ffe0e0";
                btnProxima.style.display = "block";
            }

            alternativasDiv.appendChild(alt);
        });
    }

    function escolher(i) {
        let q = questoes[indice];

        // se já respondeu antes, remover efeito anterior
        if (respostasUsuario[indice] !== undefined) {
            let anterior = respostasUsuario[indice];
            let alternativas = document.getElementsByClassName("alternativa");
            alternativas[anterior].style.backgroundColor = "#FFEDED";
        }

        // salva resposta
        respostasUsuario[indice] = i;

        // marca visualmente
        let alternativas = document.getElementsByClassName("alternativa");
        alternativas[i].style.backgroundColor = "var(--Vermelho-suave)";

        btnProxima.style.display = "block";
    }

    btnProxima.onclick = () => {
        indice++;

        if (indice >= questoes.length) {
            finalizar();
        } else {
            carregarPergunta();
        }
    };

    btnVoltar.onclick = () => {
        if (indice > 0) {
            indice--;
            carregarPergunta();
        }
    };

    function finalizar() {
        painelJogo.style.display = "none";
        painelFinal.style.display = "block";

        // calcular acertos reais
        for (let i = 0; i < questoes.length; i++) {
            if (respostasUsuario[i] === questoes[i].correta) {
                acertos++;
            } else {
                erros++;
            }
        }
        
        document.getElementById("spanCertas").innerText = acertos;
        document.getElementById("spanErradas").innerText = erros;
        document.getElementById("spanPontuacaoFinal").innerText = acertos * 10;

        var idVar = sessionStorage.ID_USUARIO;
        var idQuizVar = 1
        
    fetch("/quiz/cadastrar", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        // crie um atributo que recebe o valor recuperado aqui
        // Agora vá para o arquivo routes/usuario.js
        
        idSever: idVar,
        quizServer: idQuizVar,
        acertosServer: acertos,
        errosServer: erros
      }),
    })
      .then(function (resposta) {
        console.log("resposta: ", resposta);

        if (resposta.ok) {
            console.log("estou no the() reposta")
        } else {
          throw "Houve um erro ao tentar realizar o cadastro!";
        }
      })
      .catch(function (resposta) {
        console.log(`#ERRO: ${resposta}`);
      });

    return false;
    }

    document.getElementById("btnReiniciar").onclick = () => {
        window.location.href = "quiz.html";
    };

</script>

</html>